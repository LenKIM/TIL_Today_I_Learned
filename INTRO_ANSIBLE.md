ì¶œì²˜ : [https://brunch.co.kr/@jiseon3169ubie/1](https://brunch.co.kr/@jiseon3169ubie/1)

# ANSIBLE

ANSIBLEì„ ì´í•´í•˜ê¸° ìœ„í•´ì„œëŠ” ê°€ì¥ ë¨¼ì € Continuous Delivery(CD)ë¥¼ ì´í•´í•  í•„ìš”ê°€ ìˆë‹¤.

> ìœ„í‚¤
>
> Continuous delivery is an automated process that accelerates the release of software and digital services. It allows you to release a new service, a better web page, a bug fix, or a special offer rapidly, and with minimum manual intervention. As it becomes possible to make more frequent small changes, which are far less risky than a few largeones, you get dramatically faster and more focused feedback about whatworks and what doesn't.



- ì†Œí”„íŠ¸ì›¨ì–´ê°€ ì–¸ì œë“ ì§€ ë¦´ë¦¬ì¦ˆ ë  ìˆ˜ ìˆëŠ” ë°©ì‹ìœ¼ë¡œ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ êµ¬ì¶•í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ë¶„ì•¼ì˜ë¯¸.  
  ë¹ ë¥´ê³  ì§€ì†ì ìœ¼ë¡œ ê°€ì¹˜ ìˆëŠ” ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì¸ë„í•¨ìœ¼ë¡œì¨ ê³ ê°ì„ ë§Œì¡±ì‹œí‚¤ëŠ” ê²ƒì´ë‹¤. **ì–´ë–¤ ë³€í™”ê°€ ì¼ì–´ë‚˜ëŠ” ì¦‰ì‹œ ë¦´ë¦¬ì¦ˆ(ë°°í¬)ë  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ êµ¬ì„±í•˜ëŠ” ê²ƒì´ë‹¤.**
- ì´ë¥¼ ìœ„í•´ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Continuous Integration ë° automated Delivery Pipelineì„ êµ¬ì¶•í•´ì•¼ í•œë‹¤.

![](https://ws2.sinaimg.cn/large/006tKfTcgy1fqbdivdwxfj30zk0k1nbz.jpg)



**Continuous Integration** ì€ ì¤‘ì•™ ì €ì¥ì†Œì— ì§€ì†ì ìœ¼ë¡œ ì½”ë“œê°€ í†µí•©ë˜ê³  í…ŒìŠ¤íŠ¸ë˜ê³  ë°°í¬í•  ì¤€ë¹„ê°€ ëœë‹¤. ì´ë•Œ ì½”ë“œëŠ” ë³€ê²½ ì‹œë§ˆë‹¤ í†µí•©ë˜ê³ , í…ŒìŠ¤íŠ¸ëŠ” ì»´íŒŒì¼ ì‹œ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒì´ë‹¤.

**Release Automation**ëŠ” ê°œë°œ ì¡°ì§ê³¼ ì˜¤í¼ë ˆì´ì…˜ ì¡°ì§ ì‚¬ì´ì˜ ë¸Œë¦¬ì§€ ì—­í• ì„ í•œë‹¤. ê°œë°œ ì¡°ì§ì€ í˜•ìƒê´€ë¦¬ ì„œë²„ì— ìë™í™”ëœ íŠ¸ë¦¬ê±° ê¸°ë°˜ì˜ ë°°ì¹˜ ìœ ë‹›ì„ ì œê³µí•œë‹¤. ì´ëŠ” ìë™í™”ëœ ê°€ë“œë‚˜ ì»¨ë””ì…˜ì— ì˜í•´ ì œì–´ëœë‹¤. ì˜¤í¼ë ˆì´ì…˜ ì¡°ì§ì€ ì´ë¥¼ í†µí•´, í‘œì¤€í™”ëœ ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì‰½ê²Œ ì‚¬ìš©í•¨ìœ¼ë¡œì¨, ì¸ìŠ¤í†¨ê³¼ ê° ì»´í¬ë„ŒíŠ¸ë“¤(ì„œë²„, ë°ì´í„°ë² ì´ìŠ¤, ì„œë¹„ìŠ¤, ë²„ìŠ¤ ë“±)ì„ êµ¬ì„±í•˜ëŠ” ì—…ë¬´ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ ë¦´ë¦¬ì¦ˆ ìë™í™”ë¥¼ í†µí•´ ë°°í¬ëŠ” ëªƒ ì‹œê°„ì´ ì•„ë‹ˆë¼ ëªƒ ë¶„ ë§Œì— ì§„í–‰ë  ê²ƒì´ë‹¤.

**Provisioning**ì€ ì„œë²„ì— ì½”ë“œì˜ ë¹Œë“œ ë¸”ë¡ì„ ìë™ìœ¼ë¡œ ì„¤ì¹˜í•˜ê³  ì‹œìŠ¤í…œì„ êµ¬ì„±í•˜ê¸° ìœ„í•´, ì„œë¹„ìŠ¤ ê´€ë¦¬ ë° ì˜¤í¼ì—ë¦¬ì…˜ ì¡°ì§ì— ì˜í•´ ì‚¬ìš©ëœë‹¤.

CDì˜ ë©”ì»¤ë‹ˆì¦˜ì„ ìš´ì˜ì— ê¹Œì§€ í™•ì¥ì‹œì¼œ êµ¬í˜„í•œ ê²ƒì´ DevOpsì´ë‹¤. DevOpsì˜ êµ¬í˜„ì€ í™˜ê²½ êµ¬ì¶•ì—ì„œ ì‹œì‘í•˜ì—¬ Deploy, releaseì™€ ê°™ì€ ì‘ì—…ë“¤ì„ ìë™í™”í•˜ëŠ” ê²ƒì— ìˆìœ¼ë©° ì´ë¥¼ ì‹¤í˜„í•˜ê¸° ìœ„í•œ íˆ´ì—ëŠ” Chef, Puppet, Ansible ë“±ì´ ìˆë‹¤.

![](https://ws2.sinaimg.cn/large/006tKfTcgy1fqbdq410cdj30pa0620vg.jpg)

> ë©±ë“±ì„±(idempotence) ì´ë€?
>
> ì—°ì‚°ì„ ì—¬ëŸ¬ ë²ˆ ì ìš©í•˜ë”ë¼ë„ ê²°ê³¼ê°€ ë‹¬ë¼ì§€ì§€ ì•ŠëŠ” ì„±ì§ˆì„ ë©±ë“±ì„±(idempotence)ì´ë¼ í•œë‹¤. Puppet, chef, ansible ë“±ì€ ëª¨ë‘ ì´ëŸ° íŠ¹ì„±ì„ ê°€ì§€ê³  ìˆë‹¤. ì‰½ê²Œ ë§í•´ì„œ rest apiì˜ ê²½ìš° get, head, put, delete ë©”ì†Œë“œëŠ” ë©±ë“±ì„±ì„ ê°€ì§€ê³  ìˆë‹¤. ê·¸ëŸ¬ë‚˜ postëŠ” ìƒíƒœë¥¼ ë³€í™”ì‹œí‚¤ê¸° ë•Œë¬¸ì— ë©±ë“±ì„±ì´ ì—†ë‹¤ê³  í•  ìˆ˜ ìˆë‹¤. ì¦‰, ì„œë²„ì— ë³€í™”ë¥¼ ì£¼ê¸° ë•Œë¬¸ì´ë‹¤.

>  yaml?
>
> **YAML**ì€ XML, C, íŒŒì´ì¬, í„, RFC2822ì—ì„œ ì •ì˜ëœ e-mail ì–‘ì‹ì—ì„œ ê°œë…ì„ ì–»ì–´ ë§Œë“¤ì–´ì§„ 'ì‚¬ëŒì´ ì‰½ê²Œ ì½ì„ ìˆ˜ ìˆëŠ”' ë°ì´í„° ì§ë ¬í™” ì–‘ì‹ì´ë‹¤. 2001ë…„ì— í´ë¼í¬ ì—ë°˜ìŠ¤ê°€ ê³ ì•ˆí–ˆê³ , Ingy dot Net ë° Oren Ben-Kikiì™€ í•¨ê»˜ ë””ìì¸í–ˆë‹¤.

## WHAT?

 ìœ„ì—ì„œ ì„¤ëª…í•œ ê²ƒê³¼ ê°™ì´ Continuous Delivery ë„êµ¬ ì¤‘ í•˜ë‚˜.

### ê¸°ë³¸ê°œë…

- Playbook

ansibleì˜ í™˜ê²½ì„¤ì •, ë°°í¬ë¥¼ ê°€ëŠ¥ì¼€í•˜ëŠ” ì–¸ì–´.

Remote ì„œë²„ì— ì ‘ì†í•´ì„œ ë¬´ì–¸ê°€ë¥¼ ì‹œí–‰ì‹œí‚¤ëŠ” ì •ì±…ì„ ê¸°ìˆ í•œë‹¤. yaml ë¬¸ë²•ìœ¼ë¡œ ì •ì±…ì´ ê¸°ìˆ ë˜ì–´ ìˆìœ¼ë©° ì¢€ ë” ê³ ê¸‰ë‹¨ê³„ì—ì„œëŠ” ë¡œë“œë²¨ëŸ°ì„œë¥¼ ëª¨ë‹ˆí„°ë§í•˜ëŠ” ë³µì¡í•œ í™˜ê²½ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.

ê° playbookì€ í•˜ë‚˜ ë˜ëŠ” í•˜ë‚˜ ì´ìƒì˜ 'play'ë¥¼ ë‘”ë‹¤. playì˜ ëª©ì ì€ ì—¬ëŸ¬ í˜¸ìŠ¤íŠ¸ë“¤ì— ì˜ ì •ì˜ëœ 'role'ê³¼ 'task'ë¥¼ ë§¤í•‘í•˜ëŠ” ì—­í• ì„ í•œë‹¤.

taskëŠ” ansible ëª¨ë“ˆì˜ í˜¸ì¶œì„ ì˜ë¯¸í•œë‹¤. roleì„ ì¢€ë” í¸í•˜ê²Œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ì„œ ë¯¸ë¦¬ ì •ì˜ëœ yaml íŒŒì¼ì„ includeì„ í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.

ë˜í•œ host inventory íŒŒì¼ì— ì •ì˜ëœ ì„œë²„ ê·¸ë£¹ë³„ë¡œ ê°ê° ë‚˜ëˆ„ì–´ provision í•  ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ ìˆë‹¤. ì„œë²„ë‹¹ ë””ë ‰í† ë¦¬ë¥¼ ë‚˜ëˆ„ì–´ ê°ê°ì˜ ì„¤ì • ì •ë³´ê°€ ì •ì˜ëœ íŒŒì¼ì„ ì½ì–´ ì„¤ì¹˜í•˜ê²Œ í•œë‹¤.

![](https://ws4.sinaimg.cn/large/006tKfTcgy1fqbe4hrjkhj309q07y3zg.jpg)

- inventory

ë¦¬ëª¨íŠ¸ ì„œë²„ì— ëŒ€í•œ meta ë°ì´í„°ë¥¼ ê¸°ìˆ í•˜ëŠ” íŒŒì¼ì´ë‹¤. ansibleì—ì„œëŠ” inventory íŒŒì¼ì—ëŠ” yamlì„ ì ìš©í•˜ì§€ ì•Šì•˜ë‹¤. ê¸°ë³¸ íŒŒì¼ì€ /etc/ansible/hostsì„ ì½ê²Œ í•˜ê±°ë‚˜, ë”°ë¡œ inventory íŒŒì¼ì„ ë§Œë“¤ê³  ì˜µì…˜ì„ ì£¼ì–´ ë™ì‘í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.

ë§Œì•½ ê³ ì • IPë¥¼ ê°€ì§€ê³  ìˆê³ , hosts íŒŒì¼ ì•ˆì— ë“¤ì–´ê°€ ìˆì§€ ì•ŠëŠ” ì„œë²„ê°€ ìˆë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ ì„¤ì • íŒŒì¼ì„ ë§Œë“¤ìˆ˜ ìˆë‹¤. ì´ëŠ” í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ë§Œë“¤ ë•Œ ìœ ìš©í•˜ë‹¤.

> 192.168.1.50 ansible_ssh_user=vagrant ansible_ssh_port=22

- ëª…ë ¹ì–´ ì†Œê°œ 

\- ansible-playbook playbook yaml íŒŒì¼ì„ ì‹¤í–‰í•œë‹¤. ë¦¬ëª¨íŠ¸ í˜¸ìŠ¤íŠ¸ì— ì ‘ê·¼í•˜ì—¬ íŠ¹ì • ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ í•  ìˆ˜ ìˆë‹¤. Ansibleì—ì„œëŠ” ad-hoc task ì‹¤í–‰ì´ë¼ í•œë‹¤. Ansible-playbookì´ ì•„ë‹Œ ansible ëª…ë ¹ì–´ë¥¼ ì´ìš©í•´ì•¼ í•œë‹¤.  
ë§Œì•½ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ verbose ì˜µì…˜ì„ ì£¼ì–´ ìì„¸í•œ ë‚´ìš©ì„ ì–»ì„ ìˆ˜ ìˆë‹¤.  

> $ ansible boston â€i production â€m command â€a '/sbin/reboot'

## WHY?

1. SSHë¡œ í†µì‹ , ë¹ ë¥¸ Provisionì´ ê°€ëŠ¥í•˜ë‹¤.
2. ì¶”í›„ ìƒìš© í™˜ê²½ì—ì„œ ì‚¬ìš©í•  ë•Œ agent ê¸°ë°˜ì´ë©° ë°©í™”ë©± ì´ìŠˆ, agent ë°ëª¬ ê´€ë¦¬ë¼ëŠ” ë¶ˆí¸í•œ ì ì´ ì¡´ì¬(agent ë°©ì‹ì˜ ì¥ì ë„ ë¬¼ë¡  ì¡´ì¬í•œë‹¤. í™•ì¥ì„œ, ëŒ€ê·œëª¨ provisionì„ í•  ê²½ìš° ë§¤ìš° íš¨ê³¼ì ì´ë‹¤. ëŒ€ì‹  ì„œë²„ì™€ í†µì‹ í•˜ëŠ” ë¶€ë¶„ì´ ê³ ë„í™”ë˜ê¸° ë•Œë¬¸ì— ë¹ ë¥´ê³  ê°„ë‹¨í•œ provisionì„ í•  ìˆ˜ ì—†ë‹¤.)
3. ìë™ ë°°í¬ í™˜ê²½ì´ ì‰¬ì›Œì•¼ í•œë‹¤.
4. ê°œë°œ ê°€ëŠ¥ì„±ì´ ë†’ì€ ì˜¤í”ˆì†ŒìŠ¤
5. ë©±ë“±ì„± ì œê³µ

## HOW?

```
$ brew update
$ brew install ansible

output :=
See: https://docs.brew.sh/Homebrew-and-Python
==> Summary
ğŸº  /usr/local/Cellar/python@2/2.7.14_3: 4,602 files, 81.8MB
==> Installing ansible
==> Downloading https://homebrew.bintray.com/bottles/ansible-2.5.0.high_sierra.bottle.tar.gz
######################################################################## 100.0%
==> Pouring ansible-2.5.0.high_sierra.bottle.tar.gz
ğŸº  /usr/local/Cellar/ansible/2.5.0: 11,738 files, 142.8MB
```



## References

[103í˜¸_ê³µí•™_íŠ¸ëœë“œ_Vagreantì™€ Ansible](http://t1.daumcdn.net/brunch/service/user/17od/file/2f38mqgIEmhkl43nJ4GLBc8c92Q.pdf)

ì°¸ê³  : [ANSIBLE ì‚¬ì´íŠ¸](https://docs.ansible.com/ansible/devel/scenario_guides/guide_docker.html)

