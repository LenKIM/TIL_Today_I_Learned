# DNS(Domain Name System)

- IP 주소
  - IP프로토콜에서 호스트 구분을 위하여 반드시 필요
- 도메인 이름을 IP주소로 변환하는 서비스가 반드시 필요
- DNS 도입 전
  - 인터넷 초기에 수작업으로 관리
  - /etc/hosts 파일  
    파일의 내용은 (도메인 이름, IP주소)의 쌍으로 구성
  - 주기적으로 ftp서비스를 이용하여 수정된 파일 다운로드





- 컴퓨터 보급에 따른 기존 방법의 한계
  - 한 시스템에서 모든 호스트의 이름과 주소를 관리하는 것이 ㅂ루가능
  - 도메인 이름 중복 문제
- 해결방안
  - 위임과 계층적 도메인 이름
  - ROOT에서 하부로 위힘/ TLD에서 하위로 계속 위임
  - 위임 받은 기관에서 자신의 도메인에 속한 호스트 이름, IP주소 관리
  - 분산 데이터베이스
    - 각 기관에서 관리하고 있는 분산 데이터베이스를 연계하여 서비스 제공





### 해석기(Resolver)

- IP주소를 얻고자 하는 응용프로그램이 호출
- 응용 프로그램은 해석기에게 도메인 이름을 매개변수로 제공
- 해석기는 DNS 프로토콜을 이용하여 DNS서버에 변환을 요청
- **nslookup(dig) 명령어**



#### DNS 구성 요소

- 도메인 네임 스페이스(domain name space)  
  \- 트리 구조의 네임 스페이스를 비롯해 데이터에 대한 이름 관련 규칙을 정의  
  \- 트리에 연결된 호스트는 자원 레코드(Resouce Records)로 표현  
  \- DNS 서버스는 자원 레코드의 특정 유형 정보를 얻는 과정
- 네임 서버(name server)  
  \- 도메인 트리 구조와 트리에 보관된 자원 레코드를 관리하는 프로그램  
  \- 여러 네임 서버가 구역을 분할해 전체 도메인을 관리함  
  \- 분할한 구역을 담당하는 주(primary)네임서버와 백업 용도의 부(secondary)네임서버가 있음  
  \- 캐시에 다른 서버로부터 얻어온 정보 임시 보관
- 해석기(resolver)  
  \- 클라이언트의 요청을 받아 네임 서버로부터 정보를 얻어냄  
  \- 하나의 이상의 네임 서버와 접촉 가능  
  \- 캐시에 얻어온 정보 임시 보관

## 도메인 네임 스페이스

- DNS가 저장, 관리하는 계층적 데이터베이스
- 최상위에 루트가 존재하고, 그 아래로 모든 호스트가 트리 구조로 이어짐
- 레이블 - 이름(최대 63바이트)
- 도메인 이름 - 점(.)으로 구분한 레이블의 연속
- 루트 - 크기가 0인 Null레이블을 가짐
- 공식 표기(FQDN)할 때 마지막에 점을 붙여야 함



- 도메인  

  \- 계층적 구조

  \- 같은 레벨에서는 레이블이 유일해야 함  
  \- 도메인 이름 / 최하위 레이블을 왼쪽에 위치하고 상위로 이동하면서 레이블을 표기  

- TLD(최상위 도메인)

  \- Top Level Domain  
  \- 루트 바로 밑에 위치한 레이블  
  \- 예: mil, edu, arpa

- 도메인:  
  \- edu 도메인, mit.edu 도메인

![](https://ws1.sinaimg.cn/large/006tKfTcgy1foew02pz9jj30wj0wv4ce.jpg)



## 도메인 변환과정

- 응용 프로그램이 해석기라고 부르는 DNS 클라이언트에게 정보 제공 요청

- 해석기(resolver)

  - 해석기가 DNS 메시지 형식의 질의를 생성
  - 이 질의를 네임 서버에게 전달
  - 네임 서버는 회신용 DNS 메시지에 결과를 담아 해석기에 회신

- 네임 서버의 부담을 줄이기 위하여 캐시 정보 활용

  - 인증(authoritative) 데이터
    - 해당 데이터를 직접 관리할 책임이 있는 네임 서버로부터 받은 정보
  - 캐시 데이터
    - 이전 요청에 의하여 호스트가 보관하던 정보
  - TTL(Time To Live)동안 유효하며, 이 시간을 넘어가면 캐시 정보 삭제

- 존(Zone)

  - 존은 자원 레코드에 포함된 인증 데이터의 집합체로 정의됨

  - 관리하는 정보

    - 존에 속하는 모든 호스트이 전체 자원 레코드 집합체
    - 존에 포함된 최상위 호스트
    - 위임 서브 존
      - 자신의 존에 속하지만 인증이 위임된 경우
    - 위임된 서버 존에 관한 글루(glue) 데이터
      - 서브 존의 네임 서버에 접근할 수 있도록 해줌
    - Test.info.mit.edu의 호스트 정보를 얻고자 하는 경우
      - Info.mit.edu를 관리하는 네임 서버의 IP주소를 알면 간단히 처리
      - Info.mit.edu의 네임 서버가 서브존 도메인 내부에 위치하여 IP주소를 얻기 곤란한 경우에 글루 데이터가 필요
    - 질의 요청이 처리되는 과정
      - 인증 데이터가 반드시 필요한지 명시, 혹은 캐시
      - 해석기는 질의 요청을 재귀적으로 처리해야 하는지 명시, 혹은 비재귀적
    - 재귀적 요청
      - 해석기가 최초로 접속을 시도한 네임 서버가 질의 요청을 추적, 관리
      - 재귀적 요청을 받은 네임서버가 결과적으로 해석기 역할을 수행
    - 비재귀적
      - 요청을 받은 네임 서버가 다른 네임서버의 포인터 정보를 회신
      - 이를 받은 해석기는 다른 네임서버에게 다시 질의

    ![](https://ws1.sinaimg.cn/large/006tKfTcgy1foex0xsr3pj311i0y511x.jpg)

  ## UDP 패킷 크기로 인한 제약

- 해석기와 네임 서버는 기본적으로 UDP 53번 포트로 DNS 메시지 전송

- UDP 프로토콜의 최대 전송 크기 - 512바이트

- TCP 53번 포트를 사용하는 경우

  - 미리 512바이트보다 크다는 것을 인지하는 경우에는 처음부터 TCP 사용
  - 사전에 인지하지 못하는 경우는 TC = 1로 지정되므로, TCP 연결을 사용하여 재질의

- IPv4의 경우 UDP 사용이 일반적이나, 주소 크기가 늘어나고 기본적으로 복수 개의 주소를 가질 수 있는 IPv6, 보안이 강화된 DNSSEC의 경우 UDP크기 제한을 넘어갈 수 있음